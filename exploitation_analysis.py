import textwrap

import matplotlib.pyplot as plt
import numpy as np
import seaborn as sns


def histogram(df):
    exclude_columns = ['State', 'CMS Certification Number (CCN)', 'Provider Name', 'Address', 'City/Town', 'ZIP Code',
                       'Telephone Number']
    numeric_columns = df.select_dtypes(include=['float64', 'int64', 'float32', 'int32']).columns
    columns_to_analyze = [col for col in numeric_columns if col not in exclude_columns]

    correlation_matrix = df[numeric_columns].corr()

    # heatmap for correlation matrix
    plt.figure(figsize=(12, 8))
    sns.heatmap(correlation_matrix, annot=True, cmap='coolwarm', fmt='.2f')
    plt.title('Correlation Matrix')
    plt.show()

    plot_histograms(df, columns_to_analyze, 0, 14)
    plot_histograms(df, columns_to_analyze, 15, 30)
    plot_histograms(df, columns_to_analyze, 31, 45)


def plot_histograms(df, columns_to_analyze, start_index, end_index):
    num_columns = end_index - start_index
    num_rows = int(np.ceil(num_columns / 3))
    fig, axes = plt.subplots(num_rows, 3, figsize=(15, 4 * num_rows))

    axes = axes.flatten()

    for i in range(start_index, end_index):
        column = columns_to_analyze[i]
        print(df[column].describe(), "\n")
        ax = axes[i - start_index]
        ax.hist(df[column], bins=20, edgecolor='black')
        ax.set_title(f"{column}", fontsize=6)
        ax.set_xlabel(column, fontsize=6)
        ax.set_ylabel("Frequency", fontsize=6)
        ax.tick_params(axis='x', labelsize=6, rotation=90)
        ax.tick_params(axis='y', labelsize=6)

    for j in range(num_columns, len(axes)):
        fig.delaxes(axes[j])

    plt.tight_layout()
    plt.subplots_adjust(wspace=0.5, hspace=0.8)
    plt.show()

